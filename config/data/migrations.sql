CREATE DATABASE IF NOT EXISTS clipboard;

USE clipboard;

CREATE TABLE IF NOT EXISTS user(
    id MEDIUMINT UNIQUE NOT NULL AUTO_INCREMENT,
    email TEXT UNIQUE NOT NULL,
    username TEXT UNIQUE NOT NULL,
    password TEXT NOT NULL,
    is_admin BOOLEAN NOT NULL DEFAULT FALSE
);

CREATE TABLE IF NOT EXISTS clip(
    id MEDIUMINT PRIMARY KEY NOT NULL AUTO_INCREMENT,
    url TEXT UNIQUE NOT NULL,
    content_type ENUM('TEXT', 'FILE') NOT NULL,
	content TEXT NOT NULL,
    status ENUM('ACTIVE', 'INACTIVE') NOT NULL,
    access_type ENUM('PRIVATE', 'PUBLIC', 'PROTECTED') NOT NULL,
    created_by MEDIUMINT NULL DEFAULT NULL,
    valid_from TIMESTAMP(6) GENERATED ALWAYS AS ROW START,
    valid_to TIMESTAMP(6) GENERATED ALWAYS AS ROW END,
	expiry_time TIMESTAMP(6) NULL DEFAULT NULL,
    PERIOD FOR SYSTEM_TIME(valid_from, valid_to)
) WITH SYSTEM VERSIONING;

CREATE TABLE IF NOT EXISTS access_event(
	user_id MEDIUMINT NOT NULL,
	clip_id MEDIUMINT NOT NULL,
	action_time TIMESTAMP(6) NOT NULL DEFAULT NOW()
);

CREATE TABLE IF NOT EXISTS subscription(
	user_id MEDIUMINT NOT NULL,
	clip_id MEDIUMINT NOT NULL,
	action_time TIMESTAMP(6) NOT NULL DEFAULT NOW(),
	PRIMARY KEY (user_id, clip_id)
);

CREATE TABLE IF NOT EXISTS notification(
	for_user MEDIUMINT NOT NULL,
	by_user MEDIUMINT,
	clip_id MEDIUMINT NOT NULL,
	action_time TIMESTAMP(6) NOT NULL DEFAULT NOW(),
	status ENUM('UNREAD', 'SEEN') NOT NULL
);

CREATE TABLE IF NOT EXISTS permission(
	user_id MEDIUMINT NOT NULL,
	clip_id MEDIUMINT NOT NULL,
	user_action ENUM('WRITE', 'READ') NOT NULL
);